architecture:
  version: 0.4
  nodes:
  # ============================================================
  # 1. System
  # ============================================================
  - !Container
    name: system
    attributes:
      technology: "{{ TECHNOLOGY }}"
      global_cycle_seconds: {{ GLOBAL_CYCLE_SECONDS }}
  
  # ============================================================
  # 2. DRAM
  # ============================================================
  - !Component
    name: SEDRAM
    class: DRAM
    attributes:
      type: "LPDDR4"
      width: {{ DRAM_WIDTH }}
      datawidth: {{ DRAM_WIDTH }}
    # [修复] 删除硬编码约束，允许 Mapper 决定 (通常 DRAM 都是 keep，但为了整洁移出)

  # ============================================================
  # 3. PIM Level
  # ============================================================
  - !Container
    name: PIM_Node
    spatial: {meshX: {{ NUM_NODES }}}

  - !Component
    name: Node_SRAM
    class: smartbuffer_SRAM 
    attributes:
      depth: {{ SRAM_DEPTH }}
      width: {{ SRAM_WIDTH }}
      datawidth: {{ WORD_BITS }}
      read_bandwidth: 16
      write_bandwidth: 16
    # [关键修复] 删除这里的 constraints 块
    # 冲突曾发生在这里：arch 说 keep=[all], optimizer 说 bypass=[Inputs] -> 冲突

  # ============================================================
  # 4. PE Level
  # ============================================================
  - !Container
    name: PE_column
    spatial: {meshX: {{ PE_DIM_X }}}

  - !Container
    name: PE_row
    spatial: {meshY: {{ PE_DIM_Y }}}

  # ============================================================
  # 5. Register File (Unified)
  # ============================================================
  - !Component
    name: shared_rf
    class: smartbuffer_RF
    attributes:
      depth: 512   
      width: 16
      datawidth: {{ WORD_BITS }}
    # [关键修复] 删除这里的 constraints 块，防止 shared_rf 也报同样的错

  # ============================================================
  # 6. MAC Unit
  # ============================================================
  - !Component 
    name: MAC
    class: {{ MAC_CLASS }}
    attributes:
      multiplier_width: {{ WORD_BITS }}
      adder_width: {{ WORD_BITS * 2 }}
      datawidth: {{ WORD_BITS }}
