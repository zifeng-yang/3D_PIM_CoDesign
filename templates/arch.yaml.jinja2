architecture:
  version: 0.4
  nodes:
  # ============================================================
  # 1. System
  # ============================================================
  - !Container
    name: system
    attributes:
      technology: "{{ TECHNOLOGY }}"
      global_cycle_seconds: {{ GLOBAL_CYCLE_SECONDS }}
  
  # ============================================================
  # 2. DRAM
  # ============================================================
  - !Component
    name: SEDRAM
    class: DRAM
    attributes:
      type: "LPDDR4"
      width: {{ DRAM_WIDTH }}
      datawidth: {{ DRAM_WIDTH }}
    constraints:
      dataspace:
        keep: [Inputs, Outputs, Weights]
        bypass: []

  # ============================================================
  # 3. PIM Level
  # ============================================================
  - !Container
    name: PIM_Node
    spatial: {meshX: {{ NUM_NODES }}}

  - !Component
    name: Node_SRAM
    class: smartbuffer_SRAM 
    attributes:
      depth: {{ SRAM_DEPTH }}
      width: {{ SRAM_WIDTH }}
      datawidth: {{ WORD_BITS }}
      read_bandwidth: 16
      write_bandwidth: 16
    constraints:
      dataspace:
        keep: [Inputs, Outputs, Weights]
        bypass: []

  # [已删除 NoC 组件]

  # ============================================================
  # 4. PE Level
  # ============================================================
  - !Container
    name: PE_column
    spatial: {meshX: {{ PE_DIM_X }}}

  - !Container
    name: PE_row
    spatial: {meshY: {{ PE_DIM_Y }}}

  # ============================================================
  # 5. Register File (Unified)
  # [修改] 从 4096 减小到 512，回归理性的硬件设计
  # 512 深度依然足以通过 ResNet Layer 0 (7x7=49 inputs)，但更有挑战性
  # ============================================================
  - !Component
    name: shared_rf
    class: smartbuffer_RF
    attributes:
      depth: 512   # <--- 修改这里：从 4096 改为 512
      width: 16
      datawidth: {{ WORD_BITS }}
    constraints:
      dataspace:
        keep: [Inputs, Outputs, Weights]
        bypass: []

  # ============================================================
  # 6. MAC Unit
  # ============================================================
  - !Component 
    name: MAC
    class: {{ MAC_CLASS }}
    attributes:
      multiplier_width: {{ WORD_BITS }}
      adder_width: {{ WORD_BITS * 2 }}
      datawidth: {{ WORD_BITS }}
